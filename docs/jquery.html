<!DOCTYPE html>
<html>
<head>
    <title>如何将JQuery和RequireJS整合在一起使用</title>

    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
    
    <link rel="stylesheet" type="text/css" href="../main.css">
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <!--[if IE]> <link rel="stylesheet" type="text/css" href="../ie.css" /> <![endif]-->
    <link rel="stylesheet" type="text/css" href="http://ajax.usesos.com/ajax/libs/dojo/1.4/dojox/highlight/resources/highlight.css">

    <script type="text/javascript" src="http://ajax.usesos.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type="text/javascript" src="../init.js"></script>
    <script src="http://ajax.usesos.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js"></script>
    <script type="text/javascript">
        dojo.require("dojox.highlight");
        dojo.require("dojox.highlight.languages.javascript");
        dojo.require("dojox.highlight.languages.html");
        dojo.ready(function() {
            dojo.query("pre > code")
                .forEach(function(node) {
                    if (node.innerHTML.indexOf("DOCTYPE") !== -1 || node.innerHTML.indexOf('&lt;script') !== -1) {
                        dojo.addClass(node, "html");
                    } else {
                        dojo.addClass(node, "javascript");
                    }
                })
                .forEach(dojox.highlight.init);
        });
    </script>
</head>
<body>
<div id="grid"></div>
<div id="wrapper">

    <div id="navBg"></div>
    <div id="nav" class="mono">
        <a class="homeImageLink" href="../"></a>
        <h1>a javascript module loader</h1>

        <ul>
            <li class="hbox">
                <a href="../">主页</a>
                <span class="spacer boxFlex"></span>
                <span class="icon home"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="start.html">开始</a>
                <span class="spacer boxFlex"></span>
                <span class="icon start"></span>
            </li>
            <li class="hbox">
                <a class="local" href="download.html">下载</a>
                <span class="spacer boxFlex"></span>
                <span class="icon download"></span>
            </li>
            <li class="hbox">
                <a class="local" href="api.html">API</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
            <li class="hbox">
                <a class="local" href="optimization.html">优化</a>
                <span class="spacer boxFlex"></span>
                <span class="icon optimize"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="jquery.html">结合jQuery一起使用</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="node.html">结合Node一起使用</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="dojo.html">结合Dojo一起使用</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="commonjs.html">CommonJS备注</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="faq.html">FAQs</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="errors.html">常见错误</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="plugins.html">写一个插件</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="why.html">为什么需要Web模块化</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="whyamd.html">为什么需要AMD</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="requirements.html">需求</a>
                <span class="spacer boxFlex"></span>
                <span class="icon requirement"></span>
            </li>
            <li class="hbox">
                <a class="local" href="history.html">历史版本</a>
                <span class="spacer boxFlex"></span>
                <span class="icon history"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="http://groups.google.com/group/requirejs">需要帮助</a>
                <span class="spacer boxFlex"></span>
                <span class="icon help"></span>
            </li>
            <li class="hbox">
                <a href="http://tagneto.blogspot.com">作者博客</a>
                <span class="spacer boxFlex"></span>
                <span class="icon blog"></span>
            </li>
            <li class="hbox">
                <a href="http://twitter.com/jrburke">Twitter</a>
                <span class="spacer boxFlex"></span>
                <span class="icon twitter"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="http://github.com/jrburke/requirejs">GitHub</a>
                <span class="spacer boxFlex"></span>
                <span class="icon git"></span>
            </li>
            <li class="hbox">
                <a class="local" href="contributing.html">贡献</a>
                <span class="spacer boxFlex"></span>
                <span class="icon fork"></span>
            </li>
            <li class="hbox">
                <a class="local" href="translate.html">中文翻译</a>
                <span class="spacer boxFlex"></span>
                <span class="icon fork"></span>
            </li>
        </ul>

        <ul>
            <li class="version">1.0.3 文档</li>
        </ul>
    </div>

    <div id="content"><div id="directory" class="section">
<h1>如何将JQuery和RequireJS整合在一起使用</h1>
<ul class="index mono">
    <li class="hbox">
        <a href="#get">获取RequireJS</a><span class="spacer boxFlex"></span><span class="sect">&sect; 1</span>
    </li>
    <li class="hbox">
        <a href="#setup">创建页面</a><span class="spacer boxFlex"></span><span class="sect">&sect; 2</span>
    </li>
    <li class="hbox">
        <a href="#optimize">Feel the need for speed</a><span class="spacer boxFlex"></span><span class="sect">&sect; 3</span>
    </li>
    <li class="hbox">
        <a href="#advanced">高级应用</a><span class="spacer boxFlex"></span><span class="sect">&sect; 4</span>
    </li>
</ul>
<p>当一个项目上了一定规模，管理Script的模块就会变得很棘手。你需要保证脚本按照正确的顺序加载，在部署上得开始考虑合并脚本，使得以最少的请求来加载脚本。</p>

<p>你可能也想要在页面加载后快速加载脚本。</p>

<p>RequireJS可以帮助你管理script模块，并按正确的顺利加载它们，使用<a href="optimization.html">optimizer</a>你很容易合并它们而不需要改变标记。你也可以很容易的在页面加载完成后再加载脚本，以便减轻页面初始加载时的负荷。</p>

<p>RequireJS有一个模块系统可以让你定义出结构良好的模块，而不需要你遵守让模块独立的规范。时间一长，如果你需要创建越来越多的可重用的模块，RequireJS 可以让你很容易写出便于封装和快速加载的代码。它可以伴随你成长，特别适合需要扩展国际化的地方，如项目里各种不同的语言版本，或者在代码执行前就加载好HTML，甚至使用JSONP服务来管理。</p>
</div>

<div class="section">
<h2>
<a name="get">获取RequireJS</a>
<span class="sectionMark">&sect; 1</span>
</h2>

<p>第一步是获取RequireJS:</p>
<ul>
    <li><a href="download.html#samplejquery">下载示例</a></li>
</ul>

<p>示例中使用的是合并过的jQuery+RequireJS。如果你不想把jQuery绑定到RequireJS上，<a href="https://github.com/jrburke/require-jquery">例子中的Readme</a>中提供一个交换办法来让jQuery和RequireJS一起工作，但是需要考虑一些边缘case。</p>

</div>

<div class="section">
<h2>
<a name="setup">创建HTML页面</a>
<span class="sectionMark">&sect; 2</span>
</h2>

<p>下面是示例中的HTML页面 (假设你已经把所有的js文件都加到scripts标签里了):</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;jQuery+RequireJS Sample Page&lt;/title&gt;
        &lt;script data-main="scripts/main" src="scripts/require-jquery.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;jQuery+RequireJS Sample Page&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<span class="note">data-main的规则在RequireJS 0.23版里有所改动。在之前的版本里，上面的例子里使用的是data-main="main"</span>

<p>script标签里的data-main属性告诉RequireJS来加载scripts/main.js。RequireJS会读取data-main的值并且自动加上".js"，传递给require()方法，然后在同一个目录里加载所有依赖项。如果你觉得使用全路径看起来更舒服点，你也可以这么写： </p>

<pre><code>&lt;script data-main="scripts/main.js" src="scripts/require-jquery.js"&gt;&lt;/script&gt;
</code></pre>

<p>main.js里有什么？调用require()来加载所有需要的脚本及一些页面的初始化工作。例子里main.js加载两个插件，jquery.alpha.js和jquery.beta.js（并不是真的插件，只是个比方）。这两个插件需要和require-jquery.js在同一个目录下：</p>

<p>main.js:</p>

<pre><code>require(["jquery", "jquery.alpha", "jquery.beta"], function($) {
    //the jquery.alpha.js and jquery.beta.js plugins have been loaded.
    $(function() {
        $('body').alpha().beta();
    });
});
</code></pre>

<p>在require()方法里，"jquery"作为一个依赖项来引用。require-jquery.js采用特殊的代码来将jQuery注册为RequireJS的模块，当它注册成为模块后，你就可以获得一个句柄并将它作为回调函数的第一个参数传给require。在上面的例子里，$代表着jQuery模块。</p>

<p>而jquery.alpha和jquery.beta是jQuery的插件，所以他们不返回模块供函数参数所用。 </p>

</div>

<div class="section">
<h2>
<a name="optimize">Feel the need for speed</a>
<span class="sectionMark">&sect; 3</span>
</h2>

<p>现在你的页面可以很方便的使用<a href="optimization.html">optimizer</a>来优化了。</p>

<p>如果你下载了上面的例子，那么optimizer已经包含在里面了。</p>

<p>如果你不用上面的例子，从这里下载<a href="download.html#rjs">r.js文件</a>，你可以放在任何一个地方来使用它。</p>

<p>在这个例子里，RequireJS的代码放在和<strong>webapp</strong>同一级的目录里，webapp里面有html文件和包括所有脚本的scripts目录。完整的目录结构如下：</p>

<ul>
<li>r.js  (包括optimizer)</li>
<li>webapp/app.html</li>
<li>webapp/scripts/main.js</li>
<li>webapp/scripts/require-jquery.js</li>
<li>webapp/scripts/jquery.alpha.js</li>
<li>webapp/scripts/jquery.beta.js</li>
</ul>

<p>在scripts目录里有require-jquery.js和main.js，创建一个app.build.js文件包含以下内容： </p>

<pre><code>({
    appDir: "../",
    baseUrl: "scripts",
    dir: "../../webapp-build",
    //Comment out the optimize line if you want
    //the code minified by UglifyJS.
    optimize: "none",

    paths: {
        "jquery": "require-jquery"
    },

    modules: [
        {
            name: "main",
            exclude: ["jquery"]
        }
    ]
})
</code></pre>

<p>要使用optimizer，你需要安装<a href="http://nodejs.org">Node</a> 或者java 6。我们假装你已安装过了Node。更多信息可以查看<a href="optimization.html">Optimization page</a>。</p>

<p>编译也很简单，打开<strong>webapp/scripts</strong>目录，执行以下命令：</p>

<pre><code>node ../../r.js -o app.build.js
</code></pre>

<p>现在，在webapp-build目录里，main.js里存放的是main.js的内容，以及jquery.alpha.js和jquery.beta.js的压缩版本。这时如果你请求webapp-build目录里的app.html，就不会再请求jquery.alpha.js和jquery.beta.js了。</p>
</div>

<div class="section">
<h2>
<a name="advanced">高级应用</a>
<span class="sectionMark">&sect; 4</span>
</h2>

<p>只需要按照上面的几步，你就可以很容易用jQuery进行模块开发了，特别是你正在使用jQuery和其插件。你只需要使用合并的RequireJS就可以了。</p>

<p>理想情况下，你不需要把jQuery放在RequireJS里，只需要使用RequireJS来加载jQuery。但是，默认情况下RequireJS不能保证加载顺序，并且也不能很好的和jQuery插件一同使用。</p>

<p>一些设置：</p>

<ul>
    <li>使用<a href="api.html#order">order插件</a>来保证正确加载jQuery和插件。</li>
    <li>使用优先级配置来在其它脚本加载前加载jQuery。查看
    <a href="https://github.com/jrburke/require-jquery">Alternate Integration section
    in the require-jquery project</a>获取更多信息。</li>
    <li>把插件封装在define()方法里。</li>
</ul>

<p>理想情况下，所有的jQuery插件都可以随意调用define()来注册模块。一些插件里可能已经调用define()来注册AMD模块。如果没有，你自己可以按照如下的方式来封装：

<pre><code>define(['jquery'], function ($) {
    //Plugin code goes here.
});
</code></pre>

<p>此外，你可以让插件的作者在代码里调用define()方法。 <a href="https://github.com/umdjs/umd">umdjs project</a>
有一些资源和例子可以参考。</p>
</div>
    </div>
    <div id="footer" class="mono">
        <span class="line">Latest Release: <a href="/docs/download.html">1.0.3</a></span>
        <span class="line">Open source: <a href="https://github.com/jrburke/requirejs/blob/master/LICENSE">new BSD or MIT licensed</a></span>
        <span class="line">web design by <a href="http://andychung.ca">Andy Chung</a> &copy; 2011</span>
        <span class="line">中文翻译<a href="http://lanvige.com">ET Team</a> &copy; 2012</span>
    </div>
</div>

</body>
</html>
